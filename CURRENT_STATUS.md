# GoogleドライブAPI連携プロジェクト 現在状況記録

## 作成日時
2025年7月30日 午前0時25分

## プロジェクト概要
`sales_data.csv`ファイルの売り上げデータをGoogleドライブAPIを使用して年・月ごとに分割し、共有ドライブ内に年・月フォルダーを作成してアップロードするプロジェクト。

## 現在の状況

### ✅ 完了済み作業

#### 1. データ分割処理
- **ファイル**: `sales_data_splitter.py`
- **結果**: 成功
- **詳細**:
  - `sales_data.csv`（75件の売り上げデータ）を読み込み
  - 2023年（38件）と2024年（37件）に分割
  - 各年を12ヶ月分に分割
  - 合計24個のCSVファイルを作成
  - 保存先: `sales_data_split/`ディレクトリ

#### 2. Google Cloud Console設定
- **プロジェクト**: `sodium-replica-467313`
- **API**: Google Drive API有効化済み
- **サービスアカウント**: `googledrive-api@sodium-replica-467313-u1.iam.gserviceaccount.com`
- **認証ファイル**: `sodium-replica-467313-u1-a5e3b290705b.json`

#### 3. 共有ドライブ設定
- **共有ドライブ名**: `売り上げデータ管理用共有ドライブ`
- **共有ドライブID**: `1zv3ex_Jx1z6TJznXlaLkbeYgX6PR7B0s`
- **アクセスURL**: https://drive.google.com/drive/folders/1zv3ex_Jx1z6TJznXlaLkbeYgX6PR7B0s
- **サービスアカウント権限**: 編集者

#### 4. ファイル整理
- 不要な重複スクリプトファイルを削除
- 必要なファイルのみを残存

### 📊 データ処理状況

#### 分割済みCSVファイル一覧
```
sales_data_split/
├── 2023/
│   ├── 2023年01月_売上データ.csv (3件, ¥350,000)
│   ├── 2023年02月_売上データ.csv (3件, ¥305,000)
│   ├── 2023年03月_売上データ.csv (3件, ¥1,800,000)
│   ├── 2023年04月_売上データ.csv (3件, ¥560,000)
│   ├── 2023年05月_売上データ.csv (3件, ¥1,030,000)
│   ├── 2023年06月_売上データ.csv (3件, ¥1,890,000)
│   ├── 2023年07月_売上データ.csv (3件, ¥1,070,000)
│   ├── 2023年08月_売上データ.csv (3件, ¥620,000)
│   ├── 2023年09月_売上データ.csv (3件, ¥340,000)
│   ├── 2023年10月_売上データ.csv (3件, ¥565,000)
│   ├── 2023年11月_売上データ.csv (3件, ¥1,160,000)
│   └── 2023年12月_売上データ.csv (5件, ¥2,565,000)
└── 2024/
    ├── 2024年01月_売上データ.csv (3件, ¥1,160,000)
    ├── 2024年02月_売上データ.csv (3件, ¥1,500,000)
    ├── 2024年03月_売上データ.csv (3件, ¥1,075,000)
    ├── 2024年04月_売上データ.csv (3件, ¥3,700,000)
    ├── 2024年05月_売上データ.csv (3件, ¥2,150,000)
    ├── 2024年06月_売上データ.csv (3件, ¥2,875,000)
    ├── 2024年07月_売上データ.csv (3件, ¥2,100,000)
    ├── 2024年08月_売上データ.csv (3件, ¥2,250,000)
    ├── 2024年09月_売上データ.csv (3件, ¥2,110,000)
    ├── 2024年10月_売上データ.csv (3件, ¥2,450,000)
    ├── 2024年11月_売上データ.csv (3件, ¥1,430,000)
    └── 2024年12月_売上データ.csv (4件, ¥2,405,000)
```

**合計**: 24個のCSVファイル

### 📁 現在のファイル構成

#### 重要なファイル
- `sales_data.csv` - 元の売り上げデータ（75件）
- `sales_data_split/` - 年・月別に分割されたCSVファイル（24個）
- `upload_existing_split_data_fixed.py` - 共有ドライブアップロードスクリプト
- `run_upload_safe.bat` - 実行用バッチファイル
- `sodium-replica-467313-u1-a5e3b290705b.json` - サービスアカウントキー
- `shared_drive_config.py` - 共有ドライブ設定

#### ドキュメントファイル
- `PROGRESS_REPORT.md` - 進捗報告書
- `workspace_setup_guide.md` - Google Workspace設定手順書
- `README.md` - プロジェクト概要

#### 削除済みファイル
- 重複するアップロードスクリプト
- 不要なテストファイル
- 古いバージョンのスクリプト

### 🔧 技術的な学び

#### 1. サービスアカウントの制限
- 個人ドライブへの直接アクセス不可
- 共有ドライブでのみファイル操作可能
- ストレージクォータの制限

#### 2. 共有ドライブの権限
- 作成には管理者権限が必要
- メンバー追加で権限管理
- 編集者権限でもファイルアップロード可能

#### 3. ファイルパスの問題
- 全角スペースを含むパスの処理
- PowerShellでのパス解決方法
- バッチファイルでの回避策

### 🎯 次のステップ

#### 即座に実行可能
1. **共有ドライブへのアップロード**
   ```bash
   .\run_upload_safe.bat
   ```

#### 実行後の期待結果
- 共有ドライブ内に年・月フォルダーが作成される
- 24個のCSVファイルが対応する月フォルダーにアップロードされる
- フォルダー構造:
  ```
  売り上げデータ管理用共有ドライブ/
  ├── 2023年/
  │   ├── 01月/
  │   ├── 02月/
  │   ├── ...
  │   └── 12月/
  └── 2024年/
      ├── 01月/
      ├── 02月/
      ├── ...
      └── 12月/
  ```

### 🔄 次回作業予定

#### 作業内容
売り上げデータを年毎のフォルダに分けて、その各中に月ごとのCSVファイルを配置する作業

#### 完成イメージ
```
実践会－2025/
├── 2025/1.csv
├── 2025/2.csv
├── 2025/3.csv
├── ...
└── 2025/12.csv
└── 2026/
    ├── 2026/1.csv
    ├── 2026/2.csv
    ├── 2026/3.csv
    ├── ...
    └── 2026/12.csv
```

#### 作業手順
1. **新しいフォルダ構造の作成**
   - 年フォルダー（2025、2026など）を作成
   - 各年フォルダー内に月別CSVファイルを配置

2. **ファイル命名規則の変更**
   - 現在: `2025年01月_売上データ.csv`
   - 変更後: `2025/1.csv`、`2025/2.csv` など

3. **スクリプトの修正**
   - 新しいフォルダ構造に対応したアップロードスクリプトの作成
   - ファイル命名規則の変更に対応

4. **共有ドライブへの反映**
   - 新しい構造で共有ドライブにアップロード
   - 既存のフォルダー構造との統合または置き換え

#### 必要なファイル
- 新しいデータ分割スクリプト
- 新しいアップロードスクリプト
- フォルダー構造変更用スクリプト

#### 期待される効果
- より簡潔なファイル名
- 階層的なフォルダー構造
- 年・月の管理が容易
- データの検索・アクセスが向上

### 📋 注意事項

#### 権限設定
- サービスアカウントの権限を「コンテンツ管理者」に変更することを推奨
- 現在は「編集者」権限で設定済み

#### ファイルパス
- 全角スペースを含むディレクトリ名のため、バッチファイルを使用
- PowerShellでの直接実行は推奨しない

#### エラーハンドリング
- アップロード失敗時の再実行機能
- 一時ファイルの自動削除機能

## ステータス
🟢 **準備完了** - データ分割と共有ドライブ設定が完了し、アップロードの準備が整いました

## 最終更新日
2025年7月30日 午前0時25分 