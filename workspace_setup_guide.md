# Google WorkspaceアカウントでのAPI連携設定手順

## 前提条件
- Google Workspaceアカウントが作成済み
- 管理者権限を持つアカウントでログイン可能

## 手順1: Google Cloud Consoleでの設定

### 1.1 プロジェクトの作成
1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. Google Workspaceアカウントでログイン
3. 新しいプロジェクトを作成（例：「sales-data-api-project」）

### 1.2 Google Drive APIの有効化
1. 左側メニューから「APIとサービス」→「ライブラリ」を選択
2. 「Google Drive API」を検索して有効化

### 1.3 サービスアカウントの作成
1. 「APIとサービス」→「認証情報」を選択
2. 「認証情報を作成」→「サービスアカウント」を選択
3. サービスアカウント名を入力（例：「sales-data-uploader」）
4. 「作成して続行」をクリック
5. 役割は「編集者」を選択
6. 「完了」をクリック

### 1.4 サービスアカウントキーの作成
1. 作成したサービスアカウントをクリック
2. 「キー」タブを選択
3. 「鍵を追加」→「新しい鍵を作成」を選択
4. JSON形式を選択して「作成」
5. ダウンロードされたJSONファイルを`workspace-service-account.json`として保存

## 手順2: 共有ドライブの作成

### 2.1 Googleドライブでの共有ドライブ作成
1. [Googleドライブ](https://drive.google.com/)にアクセス
2. 左側メニューから「共有ドライブ」を選択
3. 「新規作成」をクリック
4. 共有ドライブ名を入力（例：「売り上げデータ管理用共有ドライブ」）
5. 「作成」をクリック

### 2.2 サービスアカウントの追加
1. 作成した共有ドライブを開く
2. 右上の「設定」アイコンをクリック
3. 「メンバーを管理」を選択
4. 「メンバーを追加」をクリック
5. サービスアカウントのメールアドレスを入力（例：`sales-data-uploader@project-id.iam.gserviceaccount.com`）
6. 権限は「編集者」を選択
7. 「送信」をクリック

## 手順3: スクリプトの更新

### 3.1 新しい認証ファイルの設定
- ダウンロードしたJSONファイルを`workspace-service-account.json`として保存
- 既存のスクリプトで認証ファイルパスを更新

### 3.2 共有ドライブIDの取得
- 共有ドライブのURLからIDを取得
- 例：`https://drive.google.com/drive/folders/1ABC123DEF456GHI789JKL`の場合、IDは`1ABC123DEF456GHI789JKL`

## 手順4: テスト実行

### 4.1 基本的な接続テスト
```bash
python test_workspace_connection.py
```

### 4.2 共有ドライブへのアップロードテスト
```bash
python upload_to_workspace_shared_drive.py
```

## 注意事項

1. **権限の確認**: サービスアカウントが共有ドライブにアクセスできることを確認
2. **API制限**: Google Drive APIには1日あたりの使用制限があります
3. **セキュリティ**: サービスアカウントキーは安全に管理してください

## トラブルシューティング

### よくある問題
1. **403エラー**: 権限不足の可能性
2. **404エラー**: 共有ドライブIDが間違っている可能性
3. **認証エラー**: サービスアカウントキーが正しくない可能性

### 解決方法
1. 共有ドライブの権限を再確認
2. サービスアカウントキーを再生成
3. APIの有効化状況を確認 